#!/bin/sh

# exit if a command fails
set -e

# Make sure webroot exists
mkdir -p ${CONFIG_APACHE_DOCUMENT_ROOT}

# Create server conf
cp $CONFIG_PATHS_TEMPLATES_APACHE_SERVER $CONFIG_PATHS_CONF_APACHE_SERVER

# Create Production configurations
if [ "$BUILD_ENV" = "$GENERAL_KEYS_PRD" ]; then
    cp $CONFIG_PATHS_TEMPLATES_APACHE_SSL $CONFIG_PATHS_CONF_APACHE_SSL;
fi
# Create fastcgi conf
if [ "$SETUP_PHP_FPM" = "$GENERAL_KEYS_TRUE" ]; then
    cp $CONFIG_PATHS_TEMPLATES_APACHE_FASTCGI $CONFIG_PATHS_CONF_APACHE_FASTCGI;
fi
# Set vhost template
VHOST_TEMPLATE=$CONFIG_PATHS_TEMPLATES_APACHE_VHOST_PRD

# Override vhost template if dev
if [ "$BUILD_ENV" = "$GENERAL_KEYS_DEV" ]; then
    VHOST_TEMPLATE=$CONFIG_PATHS_TEMPLATES_APACHE_VHOST_DEV;
fi
# Create vhost conf
cp $VHOST_TEMPLATE $CONFIG_PATHS_CONF_APACHE_VHOST



exit 0